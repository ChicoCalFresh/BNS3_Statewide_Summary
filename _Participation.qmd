---
title: "Participation"
editor_options: 
  chunk_output_type: console
---

```{r, include=FALSE}
source("common_code.R")
```

The following questions were asked in regards to criteria laid out by the CalFresh Requirements. This includes U.S. citizenship (or lawful permanent resident), receiving Cal Grant A/B, and receiving food from a campus meal plan. Household size and monthly income is also looked at and broken down into a chart to show CalFresh eligibility. Students were also determined to be eligible or not for CalFresh based on their responses to these criteria questions.

# Participation

**Pick all Basic Needs Programs and Services that you participate in (mark all that apply):**

```{r}
#| fig-height: 6
#| fig-width: 8
questions <- bns %>% select(starts_with("q46_"))

questions <-
  questions %>% mutate(across(everything(), function(x)
    fct_relevel(
      x,
      "Never heard of it",
      "Heard of it, but never used it",
      "Used it before attending college",
      "Used it in the past as a college student",
      "Currently use as a college student"
    )))

names(questions) <-
  c(
    'CalFresh (also known as Food Stamps or SNAP benefits)',
    'Campus food pantry (e.g., food, toiletries, feminine products)',
    'MediCal',
    'Emergency Housing Services'
  )
plot_likert(
  questions,
  grid.range = c(1.3, 1.3),
  wrap.legend.labels = 20,
  expand.grid = FALSE,
  values = "sum.outside",
  catcount = 5,
  geom.colors = likert.pal.5,
  show.prc.sign = TRUE,
  reverse.scale = TRUE
) + theme_bw() + theme(legend.position = "top")
```

<br>

## CalFresh Criteria

*Below are a series of Yes/No questions asked in order to help determine if a person is potentially eligible for CalFresh benefits.*

```{r}
# 5 questions reduced to two, keep as is, seperate plot for each question, ...

# If US citizen or has a green card, set to "Yes"
bns$citizenship <- ifelse((bns$q38 == "Yes" | bns$q39 == "Yes"), "Yes", "No")

# If meets income and household requirements, set to "Yes"
bns <- bns <- bns %>% mutate(m_income = as.numeric(monthly_hh_income, na.rm = TRUE),
  income_eligible = ifelse(((household_size == 1 & m_income < 3) |
                           (household_size == 2 & m_income < 4) |
                           (household_size == 3 & m_income < 5) |
                           (household_size == 4 & m_income < 6) |
                           (household_size == 5 & m_income < 7) |
                           (household_size == 6 & m_income < 8) |
                           (household_size == 7 & m_income < 9) |
                           (household_size == 8 & m_income < 10)), "Yes", "No"))

# If the student meets the 20 hour a week work requirement, set to "Yes"
bns$work_eligible <- ifelse(bns$paid_work_hours >= 20 | bns$unpaid_work_hours >= 20, "Yes", "No")

bns$EOP <- "Yes"


 qs <- c('citizenship', 'income_eligible', 'work_eligible')
 rnames <- c("US Citizen or lawful permanent resident i.e. has a ‘green card’",
             "Meets income/household requirements",
             "Meets 20 hours/week work exemption")
             
             
 binary_table(qs, 'Yes', rnames, "")
```

The data suggest the majority of students meet the citizenship and income requirements, however, less than half of the surveyed students meet the 20 hours/week work requirement.

## Household Size & Income

The following two questions were asked about household size and monthly income, which were then combined into a single plot:

-   **How many people in your household do you purchase and prepare food with, including yourself? This may or may not include your roommate(s). `r print_n_reporting("household_size")`**
-   **How much is your household's gross monthly income (before taxes and not including financial aid)? `r print_n_reporting("monthly_hh_income")`**

```{r}
library(huxtable)
tmp <- as.data.frame.matrix(table(bns$monthly_hh_income, bns$household_size))
huxtable(tmp, add_rownames = "") %>% set_background_color(2:12, 2:9, "tomato") %>%
  set_background_color(2:3, 2, "darkolivegreen3") %>% set_background_color(2:4, 3, "darkolivegreen3") %>% 
  set_background_color(2:5, 4, "darkolivegreen3") %>% set_background_color(2:6, 5, "darkolivegreen3") %>% 
  set_background_color(2:7, 6, "darkolivegreen3") %>% set_background_color(2:8, 7, "darkolivegreen3") %>% 
  set_background_color(2:9, 8, "darkolivegreen3") %>% set_background_color(2:10, 9, "darkolivegreen3") %>%
  set_background_color(11:12, 9, "yellow") %>%
  set_bold(2:3, 2) %>% set_bold(2:4, 3) %>% set_bold(2:5, 4) %>% set_bold(2:6, 5) %>% set_bold(2:7, 6) %>% 
  set_bold(2:8, 7) %>%  set_bold(2:9, 8) %>% set_bold(2:10, 9) %>% 
  set_italic(4:10, 2) %>% set_italic(5:10, 3) %>% set_italic(6:10, 4) %>% set_italic(7:10, 5) %>% 
  set_italic(8:10, 6) %>% set_italic(9:10, 7) %>%  set_italic(10, 8) %>% set_italic(11, 9) %>%
  set_all_borders(brdr(3, "solid", "white")) %>% map_align(by_cols("center")) %>%
  set_width(0.75) %>% set_font_size(12) %>% set_caption("Household Size")

# New color for row 12 column 8 (not sure if the two people qualify)
# Combine rows 2 and 3?
```

*In the above graph, cells highlighted in green & bold indicate a person is potentially eligible for CalFresh based on their income, cells highlighted in red & italics indicate a person is not eligible, and cells highlighted in yellow indicate a person may be eligible. This information is pulled from the CalFresh requirements section A2 (see below for link).*

## CalFresh Eligible

**This variable was created under the following criteria `r print_n_reporting("calfresh_eligible")`**

*Disclaimer: only county eligibility workers have the authority to determine official eligibility for CalFresh. These students are just most likely to be eligible based on the below listed criteria.*

-   The person is between the ages 18 to 49.\
-   The person is at least a part-time student (6 units per semester for the three campuses in this survey).\
-   The person is either a U.S. citizen or lawful permanent resident.\
-   Does not get more than half of their meals from meals plans (\< 11 per week or none).\
-   Identifies as an EOP student.\
-   Falls under the household size/income from the [Department of Social Services](https://www.cdss.ca.gov/inforesources/cdss-programs/calfresh/eligibility-and-issuance-requirements#income) requirements.

<div class = "row">

::: col-md-6
```{r}
c1 <- data.frame(bns$calfresh_eligible) %>% na.omit()
c1 <- c1 %>% mutate(ifelse(bns.calfresh_eligible==0, "No", "Yes"))
plot_frq(c1$`ifelse(bns.calfresh_eligible == 0, "No", "Yes")`,  ylim=c(0,1600)) + 
  xlab('Likely Eligible for CalFresh') + ylab("Frequency")
```
:::

<div class = "col-md-5">
